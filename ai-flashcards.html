<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Flashcard Generator - studying.works | Generate Study Cards Instantly</title>
    <meta name="description" content="Generate flashcards instantly with AI. Paste your notes or enter a topic, and our AI creates comprehensive study decks in seconds. Free AI study tool.">
    <meta name="keywords" content="AI flashcards, flashcard generator, AI study tool, generate flashcards, study cards AI, automatic flashcards">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎓</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="loading-animations.css">
    <script src="toast-notifications.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-600 via-pink-500 to-red-500" style="min-height: 100vh;">
    <script src="auth-guard.js"></script>
    <nav class="bg-black/30 backdrop-blur-lg border-b border-white/10 fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-8">
                    <a href="dashboard.html" class="text-2xl font-bold text-white flex items-center space-x-2">
                        <span>🎓</span>
                        <span>studying.works</span>
                    </a>
                    <div class="hidden md:flex space-x-4">
                        <a href="dashboard.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">Dashboard</a>
                        <a href="ai-flashcards.html" class="text-white font-semibold px-3 py-2 rounded-lg bg-white/10">AI Generator</a>
                        <a href="custom-flashcards.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">My Flashcards</a>
                        <a href="community.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">Community</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="pt-20 p-4 pb-20">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="text-8xl mb-4 animate-bounce">🤖</div>
                <h1 class="text-6xl font-bold text-white mb-4">AI Flashcard Generator</h1>
                <p class="text-2xl text-white/90">Let AI create study materials for you in seconds!</p>
            </div>

            <!-- Main Generator -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Input Section -->
                <div class="bg-white/95 backdrop-blur rounded-3xl shadow-2xl p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">📝 Input</h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Generation Mode</label>
                            <select id="mode" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg font-semibold">
                                <option value="text">From Text/Notes</option>
                                <option value="topic">From Topic</option>
                                <option value="questions">Generate Questions Only</option>
                            </select>
                        </div>

                        <div id="text-input" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Paste Your Notes or Text</label>
                                <textarea 
                                    id="input-text" 
                                    rows="10" 
                                    placeholder="Paste your study notes, textbook excerpts, or any text you want to turn into flashcards..."
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                ></textarea>
                            </div>
                        </div>

                        <div id="topic-input" class="hidden space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Topic</label>
                                <input 
                                    id="input-topic" 
                                    type="text"
                                    placeholder="e.g., Photosynthesis, World War 2, Calculus Derivatives"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                />
                            </div>
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Number of Cards</label>
                                <input 
                                    id="num-cards" 
                                    type="number"
                                    value="10"
                                    min="5"
                                    max="50"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                />
                            </div>
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Difficulty Level</label>
                                <select id="difficulty" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg">
                                    <option value="easy">Easy (Basic concepts)</option>
                                    <option value="medium" selected>Medium (Standard)</option>
                                    <option value="hard">Hard (Advanced)</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Deck Title</label>
                            <input 
                                id="deck-title" 
                                type="text"
                                placeholder="e.g., Biology Chapter 5"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                            />
                        </div>

                        <button 
                            id="generate-btn"
                            class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-bold text-xl hover:shadow-2xl transform hover:scale-105 transition-all"
                        >
                            ✨ Generate Flashcards with AI
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="bg-white/95 backdrop-blur rounded-3xl shadow-2xl p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">🎴 Generated Cards</h2>
                    
                    <div id="results-area">
                        <div class="text-center py-16 text-gray-400">
                            <div class="text-7xl mb-4">🎯</div>
                            <p class="text-lg">Your AI-generated flashcards will appear here</p>
                            <p class="text-sm mt-2">Fill in the form and click Generate!</p>
                        </div>
                    </div>

                    <div id="results-actions" class="hidden mt-6 space-y-3">
                        <button id="save-deck-btn" class="w-full bg-gradient-to-r from-green-500 to-teal-500 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all">
                            💾 Save Deck to My Flashcards
                        </button>
                        <button id="regenerate-btn" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all">
                            🔄 Regenerate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Examples -->
            <div class="mt-12 bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">💡 Examples</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="loadExample('biology')" class="bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-xl hover:shadow-lg transition-all text-left">
                        <div class="text-3xl mb-2">🧬</div>
                        <div class="font-bold">Biology Notes</div>
                        <div class="text-sm text-white/80">Photosynthesis process</div>
                    </button>
                    <button onclick="loadExample('history')" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-xl hover:shadow-lg transition-all text-left">
                        <div class="text-3xl mb-2">📜</div>
                        <div class="font-bold">History Topic</div>
                        <div class="text-sm text-white/80">American Revolution</div>
                    </button>
                    <button onclick="loadExample('math')" class="bg-gradient-to-r from-purple-400 to-pink-500 text-white p-4 rounded-xl hover:shadow-lg transition-all text-left">
                        <div class="text-3xl mb-2">📐</div>
                        <div class="font-bold">Math Concepts</div>
                        <div class="text-sm text-white/80">Calculus derivatives</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let generatedCards = [];

        // Mode switching
        document.getElementById('mode').addEventListener('change', (e) => {
            const textInput = document.getElementById('text-input');
            const topicInput = document.getElementById('topic-input');
            
            if (e.target.value === 'text' || e.target.value === 'questions') {
                textInput.classList.remove('hidden');
                topicInput.classList.add('hidden');
            } else {
                textInput.classList.add('hidden');
                topicInput.classList.remove('hidden');
            }
        });

        // Generate flashcards
        document.getElementById('generate-btn').addEventListener('click', async () => {
            const mode = document.getElementById('mode').value;
            const text = document.getElementById('input-text').value.trim();
            const topic = document.getElementById('input-topic').value.trim();
            const numCards = document.getElementById('num-cards').value;
            const difficulty = document.getElementById('difficulty').value;
            const deckTitle = document.getElementById('deck-title').value.trim();

            // Validation
            if (mode === 'text' && !text) {
                if (window.toast) {
                    toast.error('Please paste some text to generate flashcards from');
                } else {
                    alert('Please paste some text to generate flashcards from');
                }
                return;
            }
            if (mode === 'topic' && !topic) {
                if (window.toast) {
                    toast.error('Please enter a topic');
                } else {
                    alert('Please enter a topic');
                }
                return;
            }
            if (!deckTitle) {
                if (window.toast) {
                    toast.error('Please enter a deck title');
                } else {
                    alert('Please enter a deck title');
                }
                return;
            }

            // Show loading
            const loadingToast = window.toast ? toast.loading('🤖 AI is generating your flashcards...') : null;
            if (!window.toast) {
                console.log('Generating flashcards...');
            }
            document.getElementById('generate-btn').disabled = true;
            document.getElementById('generate-btn').innerHTML = '<div class="loading-dots text-white"><span></span><span></span><span></span></div>';

            try {
                // Prepare prompt
                let prompt = '';
                if (mode === 'text') {
                    prompt = `Create flashcards from this text. Generate clear question and answer pairs that test understanding of the key concepts.

Text:
${text}

Generate 10-15 flashcards in this EXACT JSON format (respond ONLY with valid JSON, no other text):
{
  "cards": [
    {"question": "Question here?", "answer": "Answer here"},
    {"question": "Question here?", "answer": "Answer here"}
  ]
}`;
                } else if (mode === 'topic') {
                    prompt = `Create ${numCards} flashcards about: ${topic}

Difficulty level: ${difficulty}

Generate flashcards that test understanding of this topic. Make questions clear and answers concise but informative.

Respond ONLY with valid JSON in this EXACT format (no other text):
{
  "cards": [
    {"question": "Question here?", "answer": "Answer here"},
    {"question": "Question here?", "answer": "Answer here"}
  ]
}`;
                } else {
                    prompt = `Generate quiz questions from this text:

${text}

Create 10-15 questions in this EXACT JSON format (respond ONLY with valid JSON):
{
  "cards": [
    {"question": "Question here?", "answer": "Answer here"}
  ]
}`;
                }

                // Call Claude API
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 4000,
                        messages: [
                            { role: "user", content: prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                let responseText = data.content[0].text;

                // Clean up response (remove markdown code blocks if present)
                responseText = responseText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

                // Parse JSON
                const result = JSON.parse(responseText);
                generatedCards = result.cards;

                // Display cards
                displayCards(generatedCards);

                // Remove loading toast
                if (loadingToast && loadingToast.remove) {
                    loadingToast.remove();
                }
                if (window.toast) {
                    toast.success(`Generated ${generatedCards.length} flashcards! 🎉`);
                } else {
                    console.log(`Generated ${generatedCards.length} flashcards!`);
                }

            } catch (error) {
                console.error('Generation error:', error);
                console.error('Error details:', error.message);
                if (typeof loadingToast !== 'undefined' && loadingToast.remove) {
                    loadingToast.remove();
                }
                if (window.toast) {
                    toast.error('Failed to generate flashcards. Please try again.');
                } else {
                    alert('Failed to generate flashcards. Error: ' + error.message);
                }
            } finally {
                document.getElementById('generate-btn').disabled = false;
                document.getElementById('generate-btn').innerHTML = '✨ Generate Flashcards with AI';
            }
        });

        function displayCards(cards) {
            const resultsArea = document.getElementById('results-area');
            const resultsActions = document.getElementById('results-actions');

            resultsArea.innerHTML = `
                <div class="space-y-3 max-h-[600px] overflow-y-auto">
                    ${cards.map((card, i) => `
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border-2 border-purple-200">
                            <div class="flex justify-between items-start mb-2">
                                <span class="bg-purple-500 text-white px-2 py-1 rounded text-xs font-bold">#${i + 1}</span>
                            </div>
                            <p class="font-bold text-gray-800 mb-1">Q: ${card.question}</p>
                            <p class="text-gray-600">A: ${card.answer}</p>
                        </div>
                    `).join('')}
                </div>
            `;

            resultsActions.classList.remove('hidden');
        }

        // Save deck
        document.getElementById('save-deck-btn').addEventListener('click', () => {
            const deckTitle = document.getElementById('deck-title').value.trim();
            
            const deck = {
                id: Date.now(),
                title: deckTitle,
                subject: 'AI Generated',
                description: `AI-generated flashcards from ${document.getElementById('mode').value === 'topic' ? 'topic' : 'text'}`,
                cards: generatedCards.map(c => ({
                    id: Date.now() + Math.random(),
                    question: c.question,
                    answer: c.answer
                })),
                created: new Date().toISOString()
            };

            const decks = JSON.parse(localStorage.getItem('flashcardDecks') || '[]');
            decks.push(deck);
            localStorage.setItem('flashcardDecks', JSON.stringify(decks));

            if (window.toast) {
                toast.success('Deck saved! Redirecting to My Flashcards...');
            } else {
                alert('Deck saved! Redirecting to My Flashcards...');
            }
            setTimeout(() => {
                window.location.href = 'custom-flashcards.html';
            }, 1500);
        });

        // Regenerate
        document.getElementById('regenerate-btn').addEventListener('click', () => {
            document.getElementById('generate-btn').click();
        });

        // Examples
        window.loadExample = function(type) {
            const examples = {
                biology: {
                    mode: 'text',
                    text: 'Photosynthesis is the process by which plants convert light energy into chemical energy. It occurs in chloroplasts and requires sunlight, water, and carbon dioxide. The light-dependent reactions occur in the thylakoid membranes, while the Calvin cycle (light-independent reactions) occurs in the stroma. The overall equation is: 6CO2 + 6H2O + light energy → C6H12O6 + 6O2.',
                    title: 'Photosynthesis Basics'
                },
                history: {
                    mode: 'topic',
                    topic: 'American Revolution key events and figures',
                    title: 'American Revolution'
                },
                math: {
                    mode: 'topic',
                    topic: 'Calculus derivatives rules and applications',
                    title: 'Calculus Derivatives'
                }
            };

            const example = examples[type];
            if (example.mode === 'text') {
                document.getElementById('mode').value = 'text';
                document.getElementById('mode').dispatchEvent(new Event('change'));
                document.getElementById('input-text').value = example.text;
            } else {
                document.getElementById('mode').value = 'topic';
                document.getElementById('mode').dispatchEvent(new Event('change'));
                document.getElementById('input-topic').value = example.topic;
            }
            document.getElementById('deck-title').value = example.title;
            if (window.toast) {
                toast.info('Example loaded! Click Generate to try it.');
            } else {
                console.log('Example loaded!');
            }
        };
    </script>
</body>
</html>