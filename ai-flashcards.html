<!DOCTYPE html>
<html lang="en">
<!-- VERSION: 2.0 - WITH HUGGING FACE FREE AI - Updated Oct 20, 2025 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Flashcard Generator - studying.works | Generate Study Cards Instantly</title>
    <meta name="description" content="Generate flashcards instantly with AI. Paste your notes or enter a topic, and our AI creates comprehensive study decks in seconds. Free AI study tool.">
    <meta name="keywords" content="AI flashcards, flashcard generator, AI study tool, generate flashcards, study cards AI, automatic flashcards">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéì</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="global-styles.css">
    <link rel="stylesheet" href="button-styles.css">
    <link rel="stylesheet" href="loading-animations.css">
</head>
<body class="bg-gradient-to-br from-purple-600 via-pink-500 to-red-500" style="background: linear-gradient(to bottom right, #111827, #1e3a8a, #581c87); min-height: 100vh;">
    <script src="toast-notifications.js"></script>
    <script src="auth-guard.js"></script>
    <nav class="bg-black/30 backdrop-blur-lg border-b border-white/10 fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-8">
                    <a href="dashboard.html" class="text-2xl font-bold text-white flex items-center space-x-2">
                        <span>üéì</span>
                        <span>studying.works</span>
                    </a>
                    <div class="hidden md:flex space-x-4">
                        <a href="dashboard.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">Dashboard</a>
                        <a href="ai-flashcards.html" class="text-white font-semibold px-3 py-2 rounded-lg bg-white/10">AI Generator</a>
                        <a href="custom-flashcards.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">My Flashcards</a>
                        <a href="community.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">Community</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="pt-24 p-4 pb-20">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="text-8xl mb-4 animate-bounce">ü§ñ</div>
                <h1 class="text-6xl font-bold text-white mb-4">AI Flashcard Generator</h1>
                <p class="text-2xl text-white/90">Let AI create study materials for you in seconds!</p>
            </div>

            <!-- Main Generator -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Input Section -->
                <div class="bg-white/95 backdrop-blur rounded-3xl shadow-2xl p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">üìù Input</h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Generation Mode</label>
                            <select id="mode" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg font-semibold">
                                <option value="text">From Text/Notes</option>
                                <option value="topic">From Topic</option>
                                <option value="questions">Generate Questions Only</option>
                            </select>
                        </div>

                        <div id="text-input" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Paste Your Notes or Text</label>
                                <textarea 
                                    id="input-text" 
                                    rows="10" 
                                    placeholder="Paste your study notes, textbook excerpts, or any text you want to turn into flashcards..."
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                ></textarea>
                            </div>
                        </div>

                        <div id="topic-input" class="hidden space-y-4">
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Topic</label>
                                <input 
                                    id="input-topic" 
                                    type="text"
                                    placeholder="e.g., Photosynthesis, World War 2, Calculus Derivatives"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                />
                            </div>
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Number of Cards</label>
                                <input 
                                    id="num-cards" 
                                    type="number"
                                    value="10"
                                    min="5"
                                    max="50"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                />
                            </div>
                            <div>
                                <label class="block text-gray-700 font-bold mb-2">Difficulty Level</label>
                                <select id="difficulty" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg">
                                    <option value="easy">Easy (Basic concepts)</option>
                                    <option value="medium" selected>Medium (Standard)</option>
                                    <option value="hard">Hard (Advanced)</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Deck Title</label>
                            <input 
                                id="deck-title" 
                                type="text"
                                placeholder="e.g., Biology Chapter 5"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                            />
                        </div>

                        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-4">
                            <label class="block text-gray-700 font-bold mb-2">
                                ü§ñ AI Provider
                            </label>
                            <select id="ai-provider" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-lg mb-3">
                                <option value="manual">üìã Manual Prompt (Use Any AI - ChatGPT, Claude, Gemini)</option>
                                <option value="flan-t5">Google FLAN-T5 (Free Token Required)</option>
                                <option value="mistral">Mistral 7B (Free Token Required)</option>
                                <option value="llama">Meta Llama 3 8B (Free Token Required)</option>
                                <option value="openai">OpenAI GPT-3.5 (Paid API Key)</option>
                            </select>
                            
                            <div id="manual-prompt-section" class="bg-green-50 border-2 border-green-300 rounded-lg p-4">
                                <p class="text-green-800 font-bold mb-2">‚ú® Manual Mode - Use Any AI!</p>
                                <p class="text-sm text-gray-700 mb-3">Click "Generate Prompt" to get a prompt you can copy to ChatGPT, Claude, Gemini, or any AI. Then paste the response back here.</p>
                                <button id="copy-prompt-btn" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg font-bold mb-2 transition-all">
                                    üìã Generate & Copy Prompt
                                </button>
                                <textarea id="manual-response" placeholder="Paste the AI's JSON response here..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none text-sm h-32 hidden"></textarea>
                                <button id="process-manual-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg font-bold mt-2 hidden transition-all">
                                    ‚úÖ Process Response
                                </button>
                            </div>
                            
                            <div id="hf-key-section" class="hidden">
                                <label class="block text-gray-700 font-bold mb-2">
                                    üîë Hugging Face Token (100% FREE!)
                                </label>
                                <input 
                                    id="hf-token" 
                                    type="password"
                                    placeholder="hf_..."
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-lg mb-2"
                                />
                                <p class="text-sm text-green-700 mb-2">
                                    ‚ú® Get your FREE token: <a href="https://huggingface.co/settings/tokens" target="_blank" class="text-blue-600 hover:underline font-bold">huggingface.co/settings/tokens</a>
                                </p>
                                <p class="text-xs text-gray-600">
                                    Click "New token" ‚Üí Name it ‚Üí Copy and paste here
                                </p>
                            </div>
                            
                            <div id="api-key-section" class="hidden">
                                <label class="block text-gray-700 font-bold mb-2">
                                    üîë OpenAI API Key
                                </label>
                                <input 
                                    id="api-key" 
                                    type="password"
                                    placeholder="sk-..."
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-lg mb-2"
                                />
                                <p class="text-sm text-gray-600">
                                    Get your API key at <a href="https://platform.openai.com/api-keys" target="_blank" class="text-blue-600 hover:underline">platform.openai.com</a>
                                </p>
                            </div>
                        </div>

                        <button 
                            id="generate-btn"
                            class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-bold text-xl hover:shadow-2xl transform hover:scale-105 transition-all"
                        >
                            ‚ú® Generate Flashcards with AI
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="bg-white/95 backdrop-blur rounded-3xl shadow-2xl p-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">üé¥ Generated Cards</h2>
                    
                    <div id="results-area">
                        <div class="text-center py-16 text-gray-400">
                            <div class="text-7xl mb-4">üéØ</div>
                            <p class="text-lg">Your AI-generated flashcards will appear here</p>
                            <p class="text-sm mt-2">Fill in the form and click Generate!</p>
                        </div>
                    </div>

                    <div id="results-actions" class="hidden mt-6 space-y-3">
                        <button id="save-deck-btn" class="w-full bg-gradient-to-r from-green-500 to-teal-500 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all">
                            üíæ Save Deck to My Flashcards
                        </button>
                        <button id="regenerate-btn" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all">
                            üîÑ Regenerate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Examples -->
            <div class="mt-12 bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">üí° Examples</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="loadExample('biology')" class="bg-gradient-to-r from-green-400 to-blue-500 text-white p-4 rounded-xl hover:shadow-lg transition-all text-left">
                        <div class="text-3xl mb-2">üß¨</div>
                        <div class="font-bold">Biology Notes</div>
                        <div class="text-sm text-white/80">Photosynthesis process</div>
                    </button>
                    <button onclick="loadExample('history')" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-xl hover:shadow-lg transition-all text-left">
                        <div class="text-3xl mb-2">üìú</div>
                        <div class="font-bold">History Topic</div>
                        <div class="text-sm text-white/80">American Revolution</div>
                    </button>
                    <button onclick="loadExample('math')" class="bg-gradient-to-r from-purple-400 to-pink-500 text-white p-4 rounded-xl hover:shadow-lg transition-all text-left">
                        <div class="text-3xl mb-2">üìê</div>
                        <div class="font-bold">Math Concepts</div>
                        <div class="text-sm text-white/80">Calculus derivatives</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let generatedCards = [];

        // Mode switching
        document.getElementById('mode').addEventListener('change', (e) => {
            const textInput = document.getElementById('text-input');
            const topicInput = document.getElementById('topic-input');
            
            if (e.target.value === 'text' || e.target.value === 'questions') {
                textInput.classList.remove('hidden');
                topicInput.classList.add('hidden');
            } else {
                textInput.classList.add('hidden');
                topicInput.classList.remove('hidden');
            }
        });

        // AI Provider switching
        document.getElementById('ai-provider').addEventListener('change', (e) => {
            const apiKeySection = document.getElementById('api-key-section');
            const hfKeySection = document.getElementById('hf-key-section');
            const manualSection = document.getElementById('manual-prompt-section');
            
            // Hide all sections first
            apiKeySection.classList.add('hidden');
            hfKeySection.classList.add('hidden');
            manualSection.classList.add('hidden');
            
            // Show relevant section
            if (e.target.value === 'openai') {
                apiKeySection.classList.remove('hidden');
            } else if (e.target.value === 'manual') {
                manualSection.classList.remove('hidden');
            } else if (['flan-t5', 'mistral', 'llama'].includes(e.target.value)) {
                hfKeySection.classList.remove('hidden');
            }
        });

        // Copy prompt button
        document.getElementById('copy-prompt-btn').addEventListener('click', () => {
            const mode = document.getElementById('mode').value;
            const text = document.getElementById('input-text').value.trim();
            const topic = document.getElementById('input-topic').value.trim();
            const numCards = document.getElementById('num-cards').value;
            const difficulty = document.getElementById('difficulty').value;
            
            let prompt = generatePromptText(mode, text, topic, numCards, difficulty);
            
            // Copy to clipboard
            navigator.clipboard.writeText(prompt).then(() => {
                if (window.toast) {
                    toast.success('‚úÖ Prompt copied! Paste it into any AI (ChatGPT, Claude, Gemini, etc.)');
                } else {
                    alert('Prompt copied to clipboard!');
                }
                // Show the response textarea
                document.getElementById('manual-response').classList.remove('hidden');
                document.getElementById('process-manual-btn').classList.remove('hidden');
            }).catch(() => {
                // Fallback: show prompt in alert
                alert('Copy this prompt:\n\n' + prompt);
                document.getElementById('manual-response').classList.remove('hidden');
                document.getElementById('process-manual-btn').classList.remove('hidden');
            });
        });

        // Process manual response
        document.getElementById('process-manual-btn').addEventListener('click', () => {
            const response = document.getElementById('manual-response').value.trim();
            if (!response) {
                if (window.toast) {
                    toast.error('Please paste the AI response first');
                } else {
                    alert('Please paste the AI response first');
                }
                return;
            }
            
            try {
                processManualResponse(response);
            } catch (error) {
                if (window.toast) {
                    toast.error('Invalid JSON. Make sure you pasted the complete response.');
                } else {
                    alert('Invalid JSON response');
                }
            }
        });

        function generatePromptText(mode, text, topic, numCards, difficulty) {
            let prompt = '';
            
            if (mode === 'text') {
                prompt = `You are an expert educational content creator specializing in creating high-quality, pedagogically sound flashcards for students.

TASK: Generate exactly 12 flashcards from the provided text. Each flashcard must test comprehension, not just recall.

INPUT TEXT:
"""
${text}
"""

REQUIREMENTS:
1. Extract the 12 most important concepts, facts, or relationships from the text
2. Questions must be clear, specific, and unambiguous
3. Answers must be concise (1-3 sentences max) but complete
4. CRITICAL: Answers should be direct and not repeat the question. Instead of "Berlin fell in 1945", write "1945" or "The city fell in 1945"
5. Cover different cognitive levels: definitions, processes, comparisons, applications
6. Avoid yes/no questions
7. Use variety: "What", "How", "Why", "Describe", "Explain", "When", "Where"
8. Each card should be self-contained (answerable without other cards)
9. For date/name/fact questions, answers should be brief and direct

OUTPUT FORMAT (CRITICAL - MUST BE VALID JSON):
{"cards":[{"question":"[Clear, specific question ending with ?]","answer":"[Concise, direct answer without repeating question words]"},{"question":"...","answer":"..."}]}

GOOD EXAMPLES:
{"cards":[
  {"question":"When did World War II end in Europe?","answer":"May 8, 1945"},
  {"question":"What is the capital of France?","answer":"Paris"},
  {"question":"What is the primary function of mitochondria?","answer":"Generating ATP through cellular respiration to power cellular processes"},
  {"question":"How does photosynthesis differ from respiration?","answer":"Photosynthesis converts light energy into glucose using CO2 and water, while respiration breaks down glucose to release energy"}
]}

BAD EXAMPLES (DO NOT DO THIS):
{"cards":[
  {"question":"When did World War II end?","answer":"World War II ended in 1945"},
  {"question":"What is the capital of France?","answer":"The capital of France is Paris"}
]}

CRITICAL: Your response must contain ONLY the JSON object. No explanations, no markdown, no code blocks. Start with { and end with }`;
            } else if (mode === 'topic') {
                // Map difficulty to cognitive depth
                let difficultyInstructions = '';
                if (difficulty === 'easy') {
                    difficultyInstructions = 'Focus on: definitions, basic concepts, simple recall. Use straightforward "What is..." questions.';
                } else if (difficulty === 'medium') {
                    difficultyInstructions = 'Focus on: explanations, processes, cause-and-effect. Mix recall with comprehension questions.';
                } else {
                    difficultyInstructions = 'Focus on: analysis, synthesis, applications, comparisons. Use "How", "Why", "Compare", "Analyze" questions.';
                }
                
                prompt = `You are an expert educational content creator specializing in creating high-quality, pedagogically sound flashcards for students.

TASK: Generate exactly ${numCards} flashcards about "${topic}"

DIFFICULTY LEVEL: ${difficulty}
${difficultyInstructions}

REQUIREMENTS:
1. Cover the most essential concepts, facts, and relationships about this topic
2. Questions must be clear, specific, and unambiguous - avoid vague phrasing
3. Answers must be accurate, concise (1-3 sentences), and complete
4. CRITICAL: Answers should be direct and not repeat the question. For "When did X happen?" answer "1945" not "X happened in 1945"
5. Progress logically from fundamental concepts to more complex ideas
6. Include variety: definitions, processes, comparisons, applications, examples
7. Avoid yes/no questions
8. Each card must be self-contained and independently answerable
9. Use academic but accessible language appropriate for the difficulty level

OUTPUT FORMAT (CRITICAL - MUST BE VALID JSON):
{"cards":[{"question":"[Clear, specific question ending with ?]","answer":"[Concise, direct answer without repeating question words]"},{"question":"...","answer":"..."}]}

GOOD EXAMPLES:
{"cards":[
  {"question":"What is Newton's First Law of Motion?","answer":"An object at rest stays at rest and an object in motion continues at constant velocity unless acted upon by an unbalanced force (law of inertia)"},
  {"question":"When was the Declaration of Independence signed?","answer":"July 4, 1776"},
  {"question":"How does inertia relate to mass?","answer":"Inertia is directly proportional to mass - greater mass means stronger resistance to changes in motion"}
]}

BAD EXAMPLES (DO NOT DO THIS):
{"cards":[
  {"question":"When was the Declaration signed?","answer":"The Declaration was signed on July 4, 1776"}
]}

CRITICAL: Your response must contain ONLY the JSON object. No explanations, no markdown formatting, no code blocks, no additional text. Start with { and end with }`;
            } else {
                // Questions mode
                prompt = `You are an expert educational content creator specializing in creating high-quality quiz questions for students.

TASK: Generate exactly 12 quiz questions from the provided text.

INPUT TEXT:
"""
${text}
"""

REQUIREMENTS:
1. Create questions that test deep understanding, not just surface-level recall
2. Questions must be answerable based solely on the provided text
3. Mix question types: factual recall, conceptual understanding, application
4. Questions should be clear and unambiguous
5. CRITICAL: Answers should be direct and concise without repeating the question stem
6. Cover all major topics mentioned in the text
7. Avoid trick questions or unnecessarily complex phrasing
8. For factual questions (dates, names, places), keep answers brief

OUTPUT FORMAT (CRITICAL - MUST BE VALID JSON):
{"cards":[{"question":"[Clear, specific question ending with ?]","answer":"[Direct, concise answer]"},{"question":"...","answer":"..."}]}

GOOD EXAMPLES:
{"cards":[
  {"question":"What role do enzymes play in biological reactions?","answer":"Biological catalysts that speed up reactions by lowering activation energy"},
  {"question":"When did the Renaissance begin in Italy?","answer":"14th century (around 1300)"},
  {"question":"What factors affect enzyme activity?","answer":"Temperature, pH, and substrate concentration"}
]}

BAD EXAMPLES (DO NOT DO THIS):
{"cards":[
  {"question":"What role do enzymes play?","answer":"Enzymes play the role of biological catalysts"}
]}

CRITICAL: Your response must contain ONLY the JSON object. No introductory text, no explanations, no markdown, no code blocks. Start directly with { and end with }`;
            }
            
            return prompt;
        }

        function processManualResponse(response) {
            // Clean up response
            let cleaned = response.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
            
            // Try to extract JSON
            let jsonMatch = cleaned.match(/\{[\s\S]*"cards"[\s\S]*\}/);
            if (jsonMatch) {
                cleaned = jsonMatch[0];
            }
            
            const result = JSON.parse(cleaned);
            if (!result.cards || !Array.isArray(result.cards)) {
                throw new Error('Invalid format');
            }
            
            generatedCards = result.cards;
            displayCards(generatedCards);
            
            if (window.toast) {
                toast.success(`‚úÖ Loaded ${generatedCards.length} flashcards!`);
            }
            
            document.getElementById('results-actions').classList.remove('hidden');
        }

        // Generate flashcards
        document.getElementById('generate-btn').addEventListener('click', async () => {
            const mode = document.getElementById('mode').value;
            const text = document.getElementById('input-text').value.trim();
            const topic = document.getElementById('input-topic').value.trim();
            const numCards = document.getElementById('num-cards').value;
            const difficulty = document.getElementById('difficulty').value;
            const deckTitle = document.getElementById('deck-title').value.trim();
            const provider = document.getElementById('ai-provider').value;
            const apiKey = document.getElementById('api-key').value.trim();
            const hfToken = document.getElementById('hf-token').value.trim();

            // Validation
            if (provider === 'manual') {
                // Just trigger the copy prompt flow
                document.getElementById('copy-prompt-btn').click();
                return;
            }
            
            if (provider === 'openai' && !apiKey) {
                if (window.toast) {
                    toast.error('Please enter your OpenAI API key');
                } else {
                    alert('Please enter your OpenAI API key');
                }
                return;
            }
            
            if (['flan-t5', 'mistral', 'llama'].includes(provider) && !hfToken) {
                if (window.toast) {
                    toast.error('Please enter your Hugging Face token');
                } else {
                    alert('Please enter your Hugging Face token');
                }
                return;
            }
            
            if (mode === 'text' && !text) {
                if (window.toast) {
                    toast.error('Please paste some text to generate flashcards from');
                } else {
                    alert('Please paste some text to generate flashcards from');
                }
                return;
            }
            if (mode === 'topic' && !topic) {
                if (window.toast) {
                    toast.error('Please enter a topic');
                } else {
                    alert('Please enter a topic');
                }
                return;
            }
            if (!deckTitle) {
                if (window.toast) {
                    toast.error('Please enter a deck title');
                } else {
                    alert('Please enter a deck title');
                }
                return;
            }

            // Show loading
            const loadingToast = window.toast ? toast.loading('ü§ñ AI is generating your flashcards...') : null;
            if (!window.toast) {
                console.log('Generating flashcards...');
            }
            document.getElementById('generate-btn').disabled = true;
            document.getElementById('generate-btn').innerHTML = '<div class="loading-dots text-white"><span></span><span></span><span></span></div>';

            try {
                // Generate optimized prompt using the same function as manual mode
                const prompt = generatePromptText(mode, text, topic, numCards, difficulty);

                // Call AI API based on provider
                let response, data, responseText;
                
                if (provider === 'flan-t5') {
                    // Google FLAN-T5 - Great for following instructions
                    response = await fetch("https://api-inference.huggingface.co/models/google/flan-t5-base", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${hfToken}`,
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            inputs: prompt,
                            parameters: {
                                max_new_tokens: 2500,
                                temperature: 0.3,
                                do_sample: false
                            },
                            options: {
                                wait_for_model: true,
                                use_cache: false
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Hugging Face Error:', errorText);
                        throw new Error(`Hugging Face API Error: ${response.status}. Make sure your token is valid.`);
                    }

                    data = await response.json();
                    console.log('FLAN-T5 raw response:', data);
                    
                    if (Array.isArray(data) && data.length > 0) {
                        responseText = data[0].generated_text || data[0].translation_text;
                    } else if (data.generated_text) {
                        responseText = data.generated_text;
                    } else {
                        throw new Error('Unexpected response format');
                    }
                    
                } else if (provider === 'mistral') {
                    // Mistral 7B Instruct
                    const formattedPrompt = `<s>[INST] ${prompt} [/INST]`;
                    
                    response = await fetch("https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${hfToken}`,
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            inputs: formattedPrompt,
                            parameters: {
                                max_new_tokens: 2500,
                                temperature: 0.3,
                                top_p: 0.9,
                                return_full_text: false
                            },
                            options: {
                                wait_for_model: true
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Hugging Face Error:', errorText);
                        throw new Error(`Hugging Face API Error: ${response.status}. Make sure your token is valid.`);
                    }

                    data = await response.json();
                    console.log('Mistral raw response:', data);
                    
                    if (Array.isArray(data) && data.length > 0) {
                        responseText = data[0].generated_text;
                    } else if (data.generated_text) {
                        responseText = data.generated_text;
                    } else {
                        throw new Error('Unexpected response format');
                    }
                    
                } else if (provider === 'llama') {
                    // Meta Llama 3 8B Instruct
                    response = await fetch("https://api-inference.huggingface.co/models/meta-llama/Meta-Llama-3-8B-Instruct", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${hfToken}`,
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            inputs: prompt,
                            parameters: {
                                max_new_tokens: 2500,
                                temperature: 0.3,
                                return_full_text: false
                            },
                            options: {
                                wait_for_model: true
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Hugging Face Error:', errorText);
                        throw new Error(`Hugging Face API Error: ${response.status}. Make sure your token is valid.`);
                    }

                    data = await response.json();
                    console.log('Llama raw response:', data);
                    
                    if (Array.isArray(data) && data.length > 0) {
                        responseText = data[0].generated_text;
                    } else if (data.generated_text) {
                        responseText = data.generated_text;
                    } else {
                        throw new Error('Unexpected response format');
                    }
                    
                    console.log('Generated text:', responseText);
                    
                } else {
                    // Use OpenAI API with optimized parameters
                    response = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo",
                            messages: [
                                { 
                                    role: "system", 
                                    content: "You are an expert educational content creator. You create pedagogically sound flashcards that test comprehension, not just recall. You ALWAYS respond with ONLY valid JSON in the exact format requested. Never include markdown formatting, code blocks, or explanatory text - ONLY the JSON object." 
                                },
                                { 
                                    role: "user", 
                                    content: prompt 
                                }
                            ],
                            temperature: 0.4,
                            max_tokens: 3000,
                            response_format: { type: "json_object" }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`OpenAI API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                    }

                    data = await response.json();
                    responseText = data.choices[0].message.content;
                }

                // Clean up response (remove markdown code blocks if present)
                responseText = responseText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                
                // Try to extract JSON if it's embedded in other text
                let jsonMatch = responseText.match(/\{[\s\S]*"cards"[\s\S]*\}/);
                if (jsonMatch) {
                    responseText = jsonMatch[0];
                }
                
                console.log('Cleaned response text:', responseText);

                // Parse JSON
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON Parse Error:', parseError);
                    console.error('Failed to parse:', responseText);
                    throw new Error('AI generated invalid response. Please try again or switch to OpenAI.');
                }
                
                if (!result.cards || !Array.isArray(result.cards) || result.cards.length === 0) {
                    throw new Error('AI did not generate any flashcards. Please try again.');
                }
                
                generatedCards = result.cards;

                // Display cards
                displayCards(generatedCards);

                // Remove loading toast
                if (loadingToast && loadingToast.remove) {
                    loadingToast.remove();
                }
                if (window.toast) {
                    toast.success(`Generated ${generatedCards.length} flashcards! üéâ`);
                } else {
                    console.log(`Generated ${generatedCards.length} flashcards!`);
                }

            } catch (error) {
                console.error('Generation error:', error);
                console.error('Error details:', error.message);
                if (typeof loadingToast !== 'undefined' && loadingToast.remove) {
                    loadingToast.remove();
                }
                if (window.toast) {
                    toast.error('Failed to generate flashcards. Please try again.');
                } else {
                    alert('Failed to generate flashcards. Error: ' + error.message);
                }
            } finally {
                document.getElementById('generate-btn').disabled = false;
                document.getElementById('generate-btn').innerHTML = '‚ú® Generate Flashcards with AI';
            }
        });

        function displayCards(cards) {
            const resultsArea = document.getElementById('results-area');
            const resultsActions = document.getElementById('results-actions');

            resultsArea.innerHTML = `
                <div class="space-y-3 max-h-[600px] overflow-y-auto">
                    ${cards.map((card, i) => `
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border-2 border-purple-200">
                            <div class="flex justify-between items-start mb-2">
                                <span class="bg-purple-500 text-white px-2 py-1 rounded text-xs font-bold">#${i + 1}</span>
                            </div>
                            <p class="font-bold text-gray-800 mb-1">Q: ${card.question}</p>
                            <p class="text-gray-600">A: ${card.answer}</p>
                        </div>
                    `).join('')}
                </div>
            `;

            resultsActions.classList.remove('hidden');
        }

        // Save deck
        document.getElementById('save-deck-btn').addEventListener('click', () => {
            const deckTitle = document.getElementById('deck-title').value.trim();
            
            const deck = {
                id: Date.now(),
                title: deckTitle,
                subject: 'AI Generated',
                description: `AI-generated flashcards from ${document.getElementById('mode').value === 'topic' ? 'topic' : 'text'}`,
                cards: generatedCards.map(c => ({
                    id: Date.now() + Math.random(),
                    question: c.question,
                    answer: c.answer
                })),
                created: new Date().toISOString()
            };

            const decks = JSON.parse(localStorage.getItem('flashcardDecks') || '[]');
            decks.push(deck);
            localStorage.setItem('flashcardDecks', JSON.stringify(decks));

            if (window.toast) {
                toast.success('Deck saved! Redirecting to My Flashcards...');
            } else {
                alert('Deck saved! Redirecting to My Flashcards...');
            }
            setTimeout(() => {
                window.location.href = 'custom-flashcards.html';
            }, 1500);
        });

        // Regenerate
        document.getElementById('regenerate-btn').addEventListener('click', () => {
            document.getElementById('generate-btn').click();
        });

        // Examples
        window.loadExample = function(type) {
            const examples = {
                biology: {
                    mode: 'text',
                    text: 'Photosynthesis is the process by which plants convert light energy into chemical energy. It occurs in chloroplasts and requires sunlight, water, and carbon dioxide. The light-dependent reactions occur in the thylakoid membranes, while the Calvin cycle (light-independent reactions) occurs in the stroma. The overall equation is: 6CO2 + 6H2O + light energy ‚Üí C6H12O6 + 6O2.',
                    title: 'Photosynthesis Basics'
                },
                history: {
                    mode: 'topic',
                    topic: 'American Revolution key events and figures',
                    title: 'American Revolution'
                },
                math: {
                    mode: 'topic',
                    topic: 'Calculus derivatives rules and applications',
                    title: 'Calculus Derivatives'
                }
            };

            const example = examples[type];
            if (example.mode === 'text') {
                document.getElementById('mode').value = 'text';
                document.getElementById('mode').dispatchEvent(new Event('change'));
                document.getElementById('input-text').value = example.text;
            } else {
                document.getElementById('mode').value = 'topic';
                document.getElementById('mode').dispatchEvent(new Event('change'));
                document.getElementById('input-topic').value = example.topic;
            }
            document.getElementById('deck-title').value = example.title;
            if (window.toast) {
                toast.info('Example loaded! Click Generate to try it.');
            } else {
                console.log('Example loaded!');
            }
        };
    </script>
    <!-- Dynamic Gradient System -->
    <script src="dynamic-gradient.js"></script>
</body>
</html>