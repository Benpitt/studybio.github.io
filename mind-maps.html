<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Maps - studying.works</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéì</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="global-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900" style="background: linear-gradient(to bottom right, #111827, #1e3a8a, #581c87); min-height: 100vh;">
    <script src="auth-guard.js"></script>
    
    <!-- Navigation -->
    <nav class="bg-black/30 backdrop-blur-lg border-b border-white/10 fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-8">
                    <a href="dashboard.html" class="text-2xl font-bold text-white flex items-center space-x-2 hover:scale-105 transition-transform">
                        <span>üéì</span>
                        <span>studying.works</span>
                    </a>
                    <div class="hidden md:flex space-x-4">
                        <a href="dashboard.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">Dashboard</a>
                        <a href="custom-flashcards.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">Flashcards</a>
                        <a href="memory-games.html" class="text-white/80 hover:text-white hover:bg-white/10 px-3 py-2 rounded-lg transition-all">Memory Games</a>
                        <a href="mind-maps.html" class="text-white font-semibold px-3 py-2 rounded-lg bg-white/10">Mind Maps</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-24">
        <!-- Header -->
        <div class="mb-8 text-center">
            <h1 class="text-5xl font-bold text-white mb-2">üó∫Ô∏è Mind Maps</h1>
            <p class="text-xl text-blue-200">Visual concept organization - see connections between ideas</p>
        </div>

        <!-- Controls -->
        <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="text-white font-bold mb-2 block">Select Deck</label>
                    <select id="deck-select" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                        <option value="">Choose a deck...</option>
                    </select>
                </div>
                <div>
                    <label class="text-white font-bold mb-2 block">Layout Style</label>
                    <select id="layout-select" class="w-full p-3 rounded-lg bg-white/20 text-white border border-white/30">
                        <option value="radial">Radial (Center Out)</option>
                        <option value="tree">Tree (Top Down)</option>
                        <option value="force">Force (Interactive)</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button onclick="generateMindMap()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-lg font-bold transition-all">
                        Generate Mind Map
                    </button>
                </div>
            </div>
        </div>

        <!-- Mind Map Canvas -->
        <div class="bg-white/10 backdrop-blur rounded-2xl p-8 mb-8">
            <div id="mindmap-container" class="bg-white rounded-xl" style="min-height: 600px;">
                <div class="flex items-center justify-center h-full min-h-[600px] text-gray-400">
                    <div class="text-center">
                        <div class="text-6xl mb-4">üó∫Ô∏è</div>
                        <p class="text-xl">Select a deck and click "Generate Mind Map"</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legend & Info -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white/10 backdrop-blur rounded-2xl p-6">
                <h3 class="text-2xl font-bold text-white mb-4">üìñ How to Use</h3>
                <ul class="text-white/90 space-y-2">
                    <li>üîµ <strong>Center node</strong> = Deck name</li>
                    <li>üü¢ <strong>Question nodes</strong> = Concepts to learn</li>
                    <li>üü° <strong>Answer nodes</strong> = Definitions/explanations</li>
                    <li>üìè <strong>Lines</strong> = Connections between concepts</li>
                    <li>üñ±Ô∏è <strong>Click nodes</strong> to see full content</li>
                    <li>üéØ <strong>Drag nodes</strong> in Force layout</li>
                </ul>
            </div>

            <div class="bg-white/10 backdrop-blur rounded-2xl p-6">
                <h3 class="text-2xl font-bold text-white mb-4">üé® Layout Styles</h3>
                <div class="text-white/90 space-y-3">
                    <div>
                        <strong class="text-purple-300">Radial:</strong> Center-out organization, good for seeing main topic with branches
                    </div>
                    <div>
                        <strong class="text-blue-300">Tree:</strong> Hierarchical top-down, good for sequential topics
                    </div>
                    <div>
                        <strong class="text-pink-300">Force:</strong> Interactive physics-based, good for exploring connections
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentDeck = null;

        // Load decks
        function loadDecks() {
            const decks = JSON.parse(localStorage.getItem('flashcardDecks') || '[]');
            const select = document.getElementById('deck-select');
            
            decks.forEach((deck, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${deck.name} (${deck.cards.length} cards)`;
                select.appendChild(option);
            });

            select.addEventListener('change', (e) => {
                if (e.target.value !== '') {
                    currentDeck = decks[e.target.value];
                }
            });
        }

        function generateMindMap() {
            if (!currentDeck) {
                alert('Please select a deck first!');
                return;
            }

            const layout = document.getElementById('layout-select').value;
            
            if (layout === 'radial') generateRadialMap();
            else if (layout === 'tree') generateTreeMap();
            else if (layout === 'force') generateForceMap();
        }

        // ===== RADIAL LAYOUT =====
        function generateRadialMap() {
            const container = document.getElementById('mindmap-container');
            container.innerHTML = '';
            
            const width = container.offsetWidth;
            const height = 600;
            
            const svg = d3.select('#mindmap-container')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            // Center node
            svg.append('circle')
                .attr('cx', centerX)
                .attr('cy', centerY)
                .attr('r', 40)
                .attr('fill', '#8B5CF6');
            
            svg.append('text')
                .attr('x', centerX)
                .attr('y', centerY)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('fill', 'white')
                .attr('font-weight', 'bold')
                .text(currentDeck.name.substring(0, 10));
            
            // Cards around the center
            currentDeck.cards.forEach((card, i) => {
                const angle = (i / currentDeck.cards.length) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                // Line from center
                svg.append('line')
                    .attr('x1', centerX)
                    .attr('y1', centerY)
                    .attr('x2', x)
                    .attr('y2', y)
                    .attr('stroke', '#60A5FA')
                    .attr('stroke-width', 2)
                    .attr('opacity', 0.6);
                
                // Question node
                const g = svg.append('g')
                    .attr('transform', `translate(${x},${y})`)
                    .style('cursor', 'pointer');
                
                g.append('circle')
                    .attr('r', 30)
                    .attr('fill', '#10B981')
                    .on('click', () => showCardDetails(card));
                
                g.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'middle')
                    .attr('fill', 'white')
                    .attr('font-size', '10px')
                    .text(`Q${i+1}`);
                
                // Answer node (further out)
                const x2 = centerX + (radius * 1.5) * Math.cos(angle);
                const y2 = centerY + (radius * 1.5) * Math.sin(angle);
                
                svg.append('line')
                    .attr('x1', x)
                    .attr('y1', y)
                    .attr('x2', x2)
                    .attr('y2', y2)
                    .attr('stroke', '#FCD34D')
                    .attr('stroke-width', 1)
                    .attr('opacity', 0.4)
                    .attr('stroke-dasharray', '5,5');
                
                const g2 = svg.append('g')
                    .attr('transform', `translate(${x2},${y2})`)
                    .style('cursor', 'pointer');
                
                g2.append('circle')
                    .attr('r', 20)
                    .attr('fill', '#FCD34D')
                    .on('click', () => showCardDetails(card));
                
                g2.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'middle')
                    .attr('fill', '#1F2937')
                    .attr('font-size', '10px')
                    .text(`A${i+1}`);
            });
        }

        // ===== TREE LAYOUT =====
        function generateTreeMap() {
            const container = document.getElementById('mindmap-container');
            container.innerHTML = '';
            
            const width = container.offsetWidth;
            const height = 600;
            
            const svg = d3.select('#mindmap-container')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            const root = {
                name: currentDeck.name,
                children: currentDeck.cards.map(card => ({
                    name: card.question.substring(0, 30) + '...',
                    fullCard: card
                }))
            };
            
            const treeLayout = d3.tree().size([width - 100, height - 100]);
            const hierarchy = d3.hierarchy(root);
            const treeData = treeLayout(hierarchy);
            
            // Links
            svg.selectAll('.link')
                .data(treeData.links())
                .enter()
                .append('path')
                .attr('class', 'link')
                .attr('d', d3.linkVertical()
                    .x(d => d.x + 50)
                    .y(d => d.y + 50))
                .attr('fill', 'none')
                .attr('stroke', '#60A5FA')
                .attr('stroke-width', 2);
            
            // Nodes
            const nodes = svg.selectAll('.node')
                .data(treeData.descendants())
                .enter()
                .append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x + 50},${d.y + 50})`)
                .style('cursor', 'pointer')
                .on('click', (event, d) => {
                    if (d.data.fullCard) showCardDetails(d.data.fullCard);
                });
            
            nodes.append('circle')
                .attr('r', d => d.depth === 0 ? 40 : 25)
                .attr('fill', d => d.depth === 0 ? '#8B5CF6' : '#10B981');
            
            nodes.append('text')
                .attr('dy', 3)
                .attr('text-anchor', 'middle')
                .attr('fill', 'white')
                .attr('font-size', d => d.depth === 0 ? '12px' : '10px')
                .text(d => d.data.name.substring(0, 15));
        }

        // ===== FORCE LAYOUT =====
        function generateForceMap() {
            const container = document.getElementById('mindmap-container');
            container.innerHTML = '';
            
            const width = container.offsetWidth;
            const height = 600;
            
            const svg = d3.select('#mindmap-container')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Prepare data
            const nodes = [
                { id: 'center', name: currentDeck.name, type: 'center', card: null }
            ];
            
            const links = [];
            
            currentDeck.cards.forEach((card, i) => {
                const qId = `q${i}`;
                const aId = `a${i}`;
                
                nodes.push({ id: qId, name: `Q${i+1}`, type: 'question', card: card });
                nodes.push({ id: aId, name: `A${i+1}`, type: 'answer', card: card });
                
                links.push({ source: 'center', target: qId });
                links.push({ source: qId, target: aId });
            });
            
            // Force simulation
            const simulation = d3.forceSimulation(nodes)
                .force('link', d3.forceLink(links).id(d => d.id).distance(100))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collision', d3.forceCollide().radius(40));
            
            // Links
            const link = svg.selectAll('.link')
                .data(links)
                .enter()
                .append('line')
                .attr('stroke', '#60A5FA')
                .attr('stroke-width', 2)
                .attr('opacity', 0.6);
            
            // Nodes
            const node = svg.selectAll('.node')
                .data(nodes)
                .enter()
                .append('g')
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));
            
            node.append('circle')
                .attr('r', d => d.type === 'center' ? 50 : 30)
                .attr('fill', d => {
                    if (d.type === 'center') return '#8B5CF6';
                    if (d.type === 'question') return '#10B981';
                    return '#FCD34D';
                })
                .style('cursor', 'pointer')
                .on('click', (event, d) => {
                    if (d.card) showCardDetails(d.card);
                });
            
            node.append('text')
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('fill', d => d.type === 'answer' ? '#1F2937' : 'white')
                .attr('font-weight', 'bold')
                .text(d => d.name.substring(0, 10));
            
            simulation.on('tick', () => {
                link
                    .attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);
                
                node.attr('transform', d => `translate(${d.x},${d.y})`);
            });
            
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }

        // Show card details in modal
        function showCardDetails(card) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4';
            modal.onclick = () => modal.remove();
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-2xl w-full" onclick="event.stopPropagation()">
                    <div class="mb-6">
                        <h3 class="text-2xl font-bold text-purple-600 mb-2">Question</h3>
                        <p class="text-gray-800 text-lg">${card.question}</p>
                    </div>
                    <div class="mb-6">
                        <h3 class="text-2xl font-bold text-green-600 mb-2">Answer</h3>
                        <p class="text-gray-800 text-lg">${card.answer}</p>
                    </div>
                    <button onclick="this.closest('.fixed').remove()" 
                            class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-3 rounded-lg font-bold transition-all">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Initialize
        loadDecks();
    </script>
</body>
</html>
